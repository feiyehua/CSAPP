# Optimizing Program Performance 
## 5.12 Understanding Memory Performance

### 5.12.1 Load Performance
```c
typedef struct ELE {
    struct ELE *next;
    long data;
} list_ele, *list_ptr;

long list_len(list_ptr ls) {
    long len = 0;
    while (ls) {
        len++;
        ls = ls->next;
    }
    return len;
}
```

```asm
.L3: loop:
    addq    $1, %rax        # Increment len
    movq    (%rdi), %rdi    # ls = ls->next
    testq   %rdi, %rdi      # Test ls
    jne     .L3             # If non-null, goto loop
```
In this case, the load operation forms the critical bottleneck in this loop.

### 5.12.2 Store Performance

The store operation does not affect any register values. Only a load operation is affected by the result of a store operation.

When a memory read depends on a recent memory write, a *write/read dependency* is formed.

```c
/* Write to dest, read from src */
void write_read(long *src, long *dst, long n)
{
    long cnt = n;
    long val = 0;

    while (cnt) {
        *dst = val;
        val = (*src) + 1;
        cnt--;
    }
}
```

In this example,
+ If src != dst, there is not read/write dependency, thus, the store and load can be performed in parallel.
+ If src == dst, it creates a data dependency between data store and load, and they must be performed in a sequence, forming the critical path.

In some cases such as prefix sum computation, `-O2` can eliminate read/write dependency.